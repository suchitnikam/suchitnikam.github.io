<html>
	<head>
		<style type='text/css'>
		   .embedded-messaging .embeddedMessagingConversationButtonWrapper .embeddedMessagingConversationButton {
				background-color: #0374F4 !important;
				background: linear-gradient(90deg, #0374F4 0%, #19BEF8 100%) !important;
			}
			
		   button#minimizedButton-20 {
				background-color: #0374F4 !important;
				background: linear-gradient(90deg, #0374F4 0%, #19BEF8 100%) !important;
		   }

		  
	</style>
<!-- 		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
	</head>
  <body>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type='text/javascript'>
	function endChat() {
		console.log("enter window.onload function ==> ");
 //  		//document.getElementById('clickButton').click();
	// 	// var btn = document.getElementById('endChatOptionText-26');
	// 	// console.log("button value ==> ", btn);
	// 	// btn.click;

		
		//$(document).ready(function() {
			console.log("document ready function ==> ");
	// 		//$('#endChatOptionButton-26').click();
	// 		//$('.endChatOption').click();
				// $("headerMenuButton-26").removeAttr("style");
			// let button = $('#headerMenuButton-26');
			// button.attr('aria-expanded', 'true');
			// $(".headerButton").setAttribute("aria-expanded", "true");
			// $(".headerButton").attr("aria-expanded","true");
				//$(".chatOverlay").css({'display' : '' });
				// $("#headerMenuButton-26").click();
				setInterval(function(){ 
				   $("#headerMenuButton-26").click();
				},2000);
		
				setInterval(function(){ 
				   $("#endChatOptionButton-26").click();
				},2000);
			 	 
	//});

		window.addEventListener("onMessagingReady", function() {
			    console.log("MIAW Messaging is ready!");
			
			    // Now we can safely end the conversation
			    if (window.messagingClient && typeof window.messagingClient.endConversation === "function") {
			        window.messagingClient.endConversation()
			            .then(() => console.log("Chat session successfully ended."))
			            .catch((error) => console.error("Error ending chat session:", error));
			    } else {
			        console.warn("endConversation is not available.");
			    }
			});

	}
	
	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'
			
			embeddedservice_bootstrap.init(
				'00D8B000001Caen',
				'Support_Enhance',
				'https://callrevu--chatbotdev.sandbox.my.site.com/ESWSupportEnhance1738239793179',
				{
					scrt2URL: 'https://callrevu--chatbotdev.sandbox.my.salesforce-scrt.com'
				}
			);

			// window.addEventListener("onEmbeddedMessagingConversationStarted", (event2) => {
			// 	console.log("111 onEmbeddedMessagingConversationStarted... entry", event2);
			// 	//let entryPayloyConversation = JSON.parse(event1.detail.conversationEntry.entryPayload);conversationId
			// 	console.log("222 conversationId value ==>", event2.detail.conversationId);
			// });
			
			let conversionRouingTypeFlage = false;
			window.addEventListener("onEmbeddedMessagingConversationRouted", (event1) => {
				console.log("11 onEmbeddedMessagingConversationRouted... entry");
				let entryPayloyConversation = JSON.parse(event1.detail.conversationEntry.entryPayload);
				// console.log("22 onEmbeddedMessagingConversationRouted event: " ,event1);
				// console.log("33 Event for conversion: " ,event1.detail.conversationEntry.entryPayload);
				console.log("44 Event for conversion: " ,entryPayloyConversation);
				console.log("55 routingType: " ,entryPayloyConversation.routingType);
				if(entryPayloyConversation.routingType == 'Initial') {
					conversionRouingTypeFlage = true;
				}
				else if(entryPayloyConversation.routingType == 'Transfer') {
					conversionRouingTypeFlage = false;
				}
			});
			
			let flag = false;
			//-----------
			let endChatFlag = false;
			console.log("endChatFlag value ==> ", endChatFlag);
			// if(endChatFlag == true) {
			// 	console.log("<== enter endChatFlag if condition ==> ");
			// 	window.onload = function() {
			// 		console.log("enter window.onload function ==> ");
  	// 				document.getElementById('clickButton').click();
			// 	}
			// }
			//-----------
			window.addEventListener("onEmbeddedMessagingConversationParticipantChanged", (event) => {
				
				// console.log("onEmbeddedMessagingConversationParticipantChanged... entry");
				// console.log("Event " ,event);
				// console.log("event.detail " ,event.detail);
				// console.log("event.detail.conversationEntry " ,event.detail.conversationEntry);
				// console.log("event.detail.conversationEntry.entryPayload " ,event.detail.conversationEntry.entryPayload);
				let entryPayloyConversation = JSON.parse(event.detail.conversationEntry.entryPayload);
				console.log("entryPayloyConversation: " ,entryPayloyConversation);
				console.log("0 entryPayloyConversation.entries[0].operation: " ,entryPayloyConversation.entries[0].operation);
				console.log("1 participant.appType: " ,entryPayloyConversation.entries[0].participant.appType);
				if(entryPayloyConversation.entries[0].operation == 'remove' && entryPayloyConversation.entries[0].participant.appType != 'agent') {
					console.log("2 operation value:  remove");
					flag = true;
					console.log("flag value ==> " ,flag);
					console.log("conversionRouingTypeFlage value ==> " ,conversionRouingTypeFlage);
					
					// need to handle end chat button click operation.
					if(flag == true && conversionRouingTypeFlage == true) {
						console.log("<== if condition entry ==> ");
						// var btn = document.getElementById("endChatOptionButton-26");
						// btn.click();
						//document.querySelectorAll(".endChatOption")[0].click();
						endChatFlag = true;
						endChat();
						
					}
					
				}
	
				
			
			});
			
			// document.getElementById("endChatOptionButton-26").click();
			// console.log("flag value ==> " ,flag);
			// console.log("conversionRouingTypeFlage value ==> " ,conversionRouingTypeFlage);
			
			// // need to handle end chat button click operation.
			// if(flag == true && conversionRouingTypeFlage == true) {
			// 	console.log("<== if condition entry ==> ");
			// }
			
			
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};

	
</script>
<script type='text/javascript' src='https://callrevu--chatbotdev.sandbox.my.site.com/ESWSupportEnhance1738239793179/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>



  </body>
</html>
